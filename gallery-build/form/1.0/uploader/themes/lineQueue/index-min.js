KISSY.add("gallery/form/1.0/uploader/themes/lineQueue/index",function(c,k,j,d,e,a,b){function f(g){this.set("queueTarget",g.queueTarget);f.superclass.constructor.call(this,g)}var h=k.all;c.extend(f,j,{_init:function(){var g=this.get("queueTarget");this.set("queue",new d(g));c.log("[LineQueue:index] inited.")},afterUploaderRender:function(g){var n=this.get("queueTarget"),m=g.get("buttonTarget"),l=g.get("queue"),u=g.get("button"),r=g.get("auth");m=h(".original-file-input",m);u.get("fileInput");var o=
5,v=this.get("defaultMsg"),s=this.get("leftMsg");if(r)o=r.getRule("max");else c.log("[LineQueue:index] Cannot get auth");h(m).remove();c.log("[LineQueue:index] old input removed.");var w=new e,p=new a({msgContainer:g.get("msgContainer")}),q=new b("#J_UploaderForm",this.get("queueTarget"));g.set("message",p);l.on("add",function(i){var x=h(".J_ItemPic",i.target),t=l.getFiles("success");w.preview(i.file.input,x);c.log("[LineQueue:index] preview done for file: "+i.file.id);t.length+1&&p.send(c.substitute(s,
{left:o-t.length-1}),"hint")});if(g.get("type")=="ajax"){c.log("[LineQueue:index] advance queue");h(this.get("queueTarget")).addClass("advance-queue")}c.log(p,"dir");h(n).delegate("click",".J_DeleltePic",function(i){i=h(i.currentTarget).attr("data-file-id");l.remove(i)});h(n).delegate("click",".J_SetMainPic",function(i){i=h(i.currentTarget).parent("li");q.setMainPic(i)});l.on("remove",function(){var i=l.getFiles("success");q.setMainPic();i=i.length?c.substitute(s,{left:o-i.length}):c.substitute(v,
{max:o});p.send(i,"hint")});g.on("success",function(){q.setMainPic()})}},{ATTRS:{defaultMsg:{value:"最多上传{max}张照片，每张图片小于5M"},leftMsg:{value:"还可以上传{left}张图片，每张小于5M。主图将在搜索结果中展示，请认真设置。"}}});return f},{requires:["node","../default/index","./queue","../../plugins/preview/preview","./message","./setMainPic","./style.css"]});
KISSY.add("gallery/form/1.0/uploader/themes/lineQueue/message",function(c,k,j){function d(b){d.superclass.constructor.call(this,b);c.log(a+"Constructed")}var e=k.all,a="[LineQueue: Message] ";c.extend(d,j,{send:function(b,f){if(!b){c.log(a+"You did not tell me what to show.");return false}var h=this.get("msgContainer"),g=this.get(f+"Cls"),n=this.get("successCls"),m=this.get("hintCls"),l=this.get("errorCls");if(h)switch(f){case "success":case "hint":case "error":e(h).html(b);e(h).replaceClass([n,m,
l].join(" "),g);return true;default:c.log(a+"type error");return false}}},{ATTRS:{msgContainer:{value:"#J_MsgBoxUpload",setter:function(b){if(b)return b;return"#J_MsgBoxUpload"}},successCls:{value:"msg-success"},hintCls:{value:"msg-hint"},errorCls:{value:"msg-error"}}});return d},{requires:["node","base"]});
KISSY.add("gallery/form/1.0/uploader/themes/lineQueue/queue",function(c,k,j,d){function e(a){e.superclass.constructor.call(this,a)}e.event=j.event;e.status=j.status;c.extend(e,j,{_renderStatus:function(a){a=a.target;var b;if(!a.length){c.log("[LineQueue:queue] Cannot get file data.");return false}c.log(a,"dir");b=a.children(".J_FileStatus");return new d(b,{queue:this,file:a})}},{ATTRS:{tpl:{value:'<li id="J_LineQueue-{id}" data-file-id="{id}" data-url="{url}" data-name="{name}" data-size="{textSize}"><div class="J_Wrapper wrapper"><div class="tb-pic120"><a href="javascript:void(0);"><img class="J_ItemPic" src="{url}" /></a></div><div class="pic-mask"></div><div class="tips-uploading"><div class="progress-bar J_ProgressBar"><span class="progress-mask J_UploadingProgress"></span></div><p class="tips-text">上传中，请稍候</p></div><div class="tips-upload-success"><span class="progress-bar"></span><p class="tips-text">上传成功！</p></div><div class="tips-upload-error"><span class="progress-bar"></span><p>上传失败</p><p>请重新尝试！</p></div><div class="tips-upload-waiting">等待上传，请稍候</div><div class="upload-op-mask"></div><div class="upload-operations"><a class="J_SetMainPic set-as-main" data-file-id="{id}" href="#">设为主图</a><a class="J_DeleltePic del-pic" data-file-id="{id}" href="#">删除</a></div></div></li>'}}});
return e},{requires:["node","../../queue/base","./status"]});
KISSY.add("gallery/form/1.0/uploader/themes/lineQueue/setMainPic",function(c,k){function j(a,b,f){a=d(a);b=d(b);f=c.mix(_config,f);if(!a||a.length<=0){c.log(e+"cannot find container");return false}if(!b||b.length<=0){c.log(e+"cannot find queue container");return false}this.container=a;this.queueContainer=b;this.input=d(c.substitute(f.tpl,{name:f.mainPicInput})).appendTo(this.container)}var d=k.all,e="[LineQueue: setMainPic] ";_config={mainPicInput:"main-pic",tpl:'<input id="J_UploadMainPicInput" name="{name}" type="hidden" value="" />'};
c.augment(j,{setMainPic:function(a){var b=this.queueContainer,f=this.getMainPic();a=d(a);if(!a||a.length<=0){a=d("li",b);if(a[0])if(f.length>0){c.log(e+"Already have a main pic. Since you do not tell me which one to set as main pic, I will do nothing.");return f}else{c.log(e+"No li element specified. I will set the first pic as main pic.");a=a[0]}else{c.log(e+"There is no pic. I cannot set any pic as main pic. So I will empty the main pic input.");d(this.input).val("");return null}}b=d(".J_Wrapper",
a);var h=d('<span class="main-pic-logo">主图</span>'),g=d(a).attr("data-url");if(f.length>0){d(f).removeClass("main-pic");d(".main-pic-logo",f).remove()}d(a).addClass("main-pic");d(h).appendTo(b);d(this.input).val(g);return a},getMainPic:function(){return d(this.queueContainer).children(".main-pic")},getMainPicUrl:function(){return d(this.input).val()}});return j},{requires:["node"]});
KISSY.add("gallery/form/1.0/uploader/themes/lineQueue/status",function(c,k,j){function d(a,b){d.superclass.constructor.call(this,a,b);this.set("target",e(a))}var e=k.all;d.type=j.type;c.extend(d,j,{_waiting:function(){this.get("uploader");this.get("queue");var a=this.get("file");e(a).attr("data-file-id");if(a.length<=0){c.log("[LineQueue: status] Cannot find this file");return false}e(a).addClass("upload-waiting")},_start:function(){this.get("target");var a=this.get("uploader"),b=this.get("file");
a=a.get("type");e(b).replaceClass("upload-waiting","uploading");if(a=="ajax"){b=e(".J_ProgressBar",b);this.set("progressBar",e(".J_UploadingProgress",b))}},_progress:function(a){a=Math.ceil(a.loaded/a.total*100);this.get("uploader");var b=this.get("progressBar");if(!b){c.log("[LineQueue: status] Cannot find progress bar");return false}e(b).width(100-a+"%")},_success:function(){var a=this.get("file");this.get("uploader").get("loaded");e(a).replaceClass("uploading","upload-success");setTimeout(function(){e(a).replaceClass("upload-success",
"upload-done")},1E3)},_error:function(a){if(!c.isObject(a)||!a.msg)a={msg:"文件上传失败！"};var b=this.get("file"),f=e(b).attr("data-file-id"),h=this.get("uploader"),g=this.get("queue");h.get("message").send(a.msg,"error");e(b).replaceClass("uploading","upload-error");setTimeout(function(){g.remove(f)},1E3)}},{ATTRS:{tpl:{value:{waiting:'<div class="clearfix"><div class="f-l">0%</div><div class="f-l uploader-icon del-icon J_DelFile"></div></div>',start:'<div class="clearfix"><div class="J_ProgressNum"><img class="loading" src="http://img01.taobaocdn.com/tps/i1/T1F5tVXjRfXXXXXXXX-16-16.gif" alt="loading" /></div></div> ',
success:'<div class="uploader-icon success-icon">100%</div>',cancel:'<div>已经取消上传，<a href="#reUpload" class="J_ReUpload">点此重新上传</a> </div>',error:'<div class="upload-error">{msg}<a href="#fileDel" class="J_FileDel">点此删除</a></div>'}}}});return d},{requires:["node","../../queue/status","../../plugins/progressBar/progressBar"]});
