KISSY.add("gallery/form/1.2/checkbox/index",function(l,p,q){function n(a,b){n.superclass.constructor.call(this,b);this.set("target",a)}var d=q.all;l.extend(n,p,{render:function(){this._loadCss();this._replaceCheckbox();this._bindEvent()},recoverCheckbox:function(){var a=this.get("target"),b=this.get("checkboxs");d(b).each(function(c,e){c.hide();d(a[e]).show()});return this},_replaceCheckbox:function(){var a=this,b=a.get("target"),c=a._getHtml(0),e=a._getHtml(2),g=a._getHtml(1),j,k=[],f=a.get("accessible"),
m=a.get("getLabelFunc"),o;if(b.length===0)return false;b.each(function(h){h.hide();if(a._isDisabled(h))j=d(e).insertBefore(h).attr("ks-checkbox-disabled","disabled").removeAttr("tabindex");else{j=a._isChecked(h)?d(g):d(c);j.insertBefore(h)}try{if(f){o=m?m(h).html():h.next("label").html();j.attr("aria-label",o)}}catch(r){l.log("html结构不符合");return false}k.push(j)});a.set("checkboxs",k)},_loadCss:function(){var a=this.get("cssUrl");a!==""&&l.use(a,function(){})},_getHtml:function(a){var b=this.get("cls"),
c=b.checked,e=b.disabled;b={defalutName:b.init};switch(a){case 0:b.secondName="";break;case 1:b.secondName=c;break;case 2:b.secondName=e}return l.substitute('<span tabindex="0" class="{defalutName} {secondName}"></span>',b)},_bindEvent:function(){var a=this,b=d(a.get("checkboxs")),c=this.get("cls").hover,e=a.get("hasLabel"),g=a.get("target"),j=a.get("getLabelFunc"),k;b.each(function(f,m){f.on("mouseenter mouseleave",function(h){if(!(a._isChecked(f)||a._isDisabled(f)))switch(h.type){case "mouseenter":f.addClass(c);
break;case "mouseleave":f.removeClass(c)}}).on("click",function(){a._isDisabled(f)||a._clickHandler.call(a,m)}).on("keyup",function(h){h.keyCode===13&&f.fire("click")});if(e)try{k=j?j(d(g[m])):f.next("label");k.on("click",function(){f.fire("click")}).on("mouseenter",function(){f.fire("mouseenter")}).on("mouseleave",function(){f.fire("mouseleave")})}catch(o){l.log("html结构不符合");return false}})},_clickHandler:function(a){var b=this.get("target"),c=d(this.get("checkboxs")[a]),e=this.get("cls").checked;
d(b[a]).fire("click");c.toggleClass(e)},_isDisabled:function(a){var b=d(a).attr("disabled");a=d(a).attr("ks-checkbox-disabled");return b==="disabled"||a==="disabled"},_isChecked:function(a){var b=d(a).prop("checked");a=d(a).hasClass(this.get("cls").checked);return b||a},setDisabled:function(a){var b=this.get("checkboxs"),c=this.get("target"),e,g=this.get("cls"),j=g.checked,k=g.disabled;g=g.hover;if(typeof a==="number"){e=d(b[a]);a=d(c[a]);e.attr("ks-checkbox-disabled","disabled").removeClass(j+" "+
g).addClass(k);a.attr("disabled","disabled")}e.removeAttr("tabindex");return this},setAvailabe:function(a){var b=this.get("checkboxs"),c=this.get("target"),e,g=this.get("cls").disabled;if(typeof a==="number"){e=d(b[a]);a=d(c[a]);e.removeAttr("ks-checkbox-disabled","disabled").removeClass(g);a.removeAttr("disabled","disabled")}e.attr("tabindex","0");return this},selectAll:function(){var a=this,b=a.get("checkboxs");d(b).each(function(c){a._isChecked(c)||c.fire("click")});return a},resetAll:function(){var a=
this,b=a.get("checkboxs"),c=a.get("cls").hover;d(b).each(function(e){a._isChecked(e)&&e.fire("click").removeClass(c)});return a},getAllChecked:function(){var a=this.get("target"),b=[],c;i=0;for(len=a.length;i<len;i++){c=d(a[i]);this._isDisabled(c)||this._isChecked(c)&&b.push(i)}return b}},{ATTRS:{target:{value:"",setter:function(a){return d(a)},getter:function(a){return d(a)}},checkboxs:{value:[]},cls:{value:{init:"ks-checkbox",checked:"ks-checkbox-checked",disabled:"ks-checkbox-disabled",hover:"ks-checkbox-hover"}},
cssUrl:{value:"gallery/form/1.2/checkbox/themes/default/style.css"},hasLabel:{value:false},getLabelFunc:{value:undefined,setter:function(a){return a},getter:function(a){return a}},accessible:{value:false}}});return n},{requires:["base","node"]});
