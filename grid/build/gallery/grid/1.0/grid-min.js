KISSY.add("gallery/grid/1.0/util",function(b){var d=b.DOM,a=b.Event,f=window,e=document,c=b.UA;b.LP=b.namespace("LP");b.mix(b.LP,{mask:function(){var j=b.one("body"),n=j.height(),i=d.viewportHeight(),g=n>i?n:i,k=b.LP.maskElement(j);k.height(g);a.on(f,"resize",l);k.data("reszieFunc",l);var m=null;function l(){if(m){clearTimeout(m)}m=setTimeout(h,300)}function h(){var p=d.viewportHeight(),o=n>p?n:p;k.height(o)}},unmask:function(){var g=b.one("body"),i=g.children(".lp-el-mask"),h=i.data("reszieFunc");if(h){a.remove(f,"resize",h);i.data("reszieFunc",null)}b.LP.unmaskElement(g)},maskElement:function(k,i,l){var p=b.one(k),g=p.getDOMNode(),h=b.one(".lp-el-mask",g);if(!h){var h=b.one(d.create('<div class="lp-el-mask"></div>')).appendTo(g);p.addClass("x-masked-relative x-masked");if(c.ie==6){h.height(p.height())}if(i){var q=['<div class="lp-el-mask-msg"><div>',i,"</div></div>"].join(""),n=b.one(d.create(q)).appendTo(g);if(l){n.addClass(l)}try{var j=(p.width()-n.width())/2,o=(p.height()-n.height())/2;n.css({left:j,top:o})}catch(m){b.log("width error!")}}}return h},unmaskElement:function(i){var g=b.one(i),k=g.getDOMNode(),h=g.children(".lp-el-mask-msg"),j=g.children(".lp-el-mask");if(h){h.remove()}if(j){j.remove()}g.removeClass("x-masked-relative x-masked")}});b.LP.Format=function(){return{dateRenderer:function(i){if(!i){return""}try{var g=new Date(i)}catch(h){return""}if(!g||!g.getFullYear){return""}return b.Date.format(i,"yyyy-mm-dd")},datetimeRenderer:function(j){if(!j){return""}try{var g=new Date(j)}catch(i){return""}if(!g||!g.getFullYear){return""}var h=b.Date.format(j,"yyyy-mm-dd HH:MM:ss");return h},cutTextRenderer:function(g){return function(h){h=h||"";if(h.toString().length>g){return h.toString().substring(0,g)+"..."}return h}},enumRenderer:function(g){return function(h){return g[h]||""}},multipleItemsRenderer:function(h){var g=b.LP.Format.enumRenderer(h);return function(j){if(!j){return""}var i=[];if(b.isArray(j)){j=j.toString().split(",")}b.each(j,function(k){i.push(g(k))});return i.join(",")}}}}();b.LP.FormHelpr={serialize:function(g){return b.param(b.LP.FormHelpr.serializeToObject(g))},serializeToObject:function(i){var j=b.makeArray(i.elements);j=b.filter(j,function(k){return(k.id||k.name)&&!k.disabled&&(this.checked||/select|textarea/i.test(k.nodeName)||/text|hidden|password/i.test(k.type))});var h=[];b.each(j,function(k){var m=b.one(k).val(),l=m==null?null:b.isArray(m)?b.map(m,function(o,n){return{name:k.name||k.id,value:o}}):{name:k.name||k.id,value:m};if(l){h.push(l)}});var g={};b.each(h,function(l){var m=g[l.name];if(!m){g[l.name]=l.value}else{if(b.isArray(m)){m.push(l.value)}else{var k=[];k.push(m);k.push(l.value);g[l.name]=k}}});return g}};return b.LP},{requires:["core","calendar"]});KISSY.add("gallery/grid/1.0/bar",function(c,f){var e=c.DOM,a=c.Node;var b="bar-btn-container";function d(h){var g=this;h=h||{};d.superclass.constructor.call(g,h);g._init()}c.extend(d,c.Base);c.augment(d,{CLS_BAR:"",_findItem:function(g){if(e.hasClass(g,b)){return g}else{return e.parent(g,"."+b)}},_getBarTemplate:function(){return"<div></div>"},_init:function(){var g=this,j=g.get("items"),n=g.get("defaults"),m=null,h=null;for(var k=0,l=j.length;k<l;k++){m=c.merge(n,j[k]);if(c.isUndefined(m.id)){m.id=k}if(!m.isBarItem){h=f.types[m.type||"text"];if(!h){h=f.types.text}j[k]=new h(m)}}g._initDOM();g._initEvent()},_initDOM:function(){var g=this,l=g._getBarTemplate(),n=g.get("renderTo"),i=e.get("#"+n),k=g.get("items"),j=new a(l).appendTo(i),h=new a('<table style="border-spacing: 0;"><tr></tr></table>').appendTo(j),m=e.get("tr",h[0]);g.set("bar",j);c.each(k,function(q,p){var o=m.insertCell(p);q.renderTo(o)});e.addClass(i,g.CLS_BAR);e.show(i)},_initEvent:function(){var g=this.get("items");c.each(g,function(h){h.attachEvent()})}});return d},{requires:["./barItem"]});KISSY.add("gallery/grid/1.0/barItem",function(j){var o=j.DOM,p=j.Node;function b(t){t+="";return t.charAt(0).toUpperCase()+t.substring(1)}var e="_uiSet",r="disabled",l="lp-item-disabled",f="bar-btn-container",n="pb-text-container",d="bar-btn-custom",g="bar-item-btn",i="bar-item-over",c="bar-item-separator";CLS_ITEM_INPUT="pb-item-input",CLS_BAR_ICON="bar-icon";function s(u){var t=this;u=j.merge({isBarItem:true,css:""},u);j.mix(t,u);s.superclass.constructor.call(t,u);t._init()}j.extend(s,j.Base);j.augment(s,{attachEvent:function(){var t=this,u=t.get("el");if(u){if(t.handler){u.on("click",t.handler)}}},renderTo:function(v){if(this.get("el")){return this.get("el")}var t=this,u=t._getItemTemplate(),w=new j.Node(u).appendTo(v);t.set("el",w);return w},_bindUI:function(){var v=this,w=v.__attrs,u,t;for(u in w){if(w.hasOwnProperty(u)){v.on("after"+b(u)+"Change",function(x){v[u]=x.newVal});t=e+b(u);if(v[t]){(function(y,x){v.on("after"+b(y)+"Change",function(z){v[x](z.newVal,z)})})(u,t)}}}},_getItemTemplate:function(){return""},_init:function(){var t=this;t._bindUI()},destroy:function(){var t=this,u=t.get("el");u.remove();t.detach();t.__attrVals={}}});function q(u){var t=this;q.superclass.constructor.call(t,u)}j.extend(q,s);j.augment(q,{attachEvent:function(){var t=this,u=t.get("el");t.constructor.superclass.attachEvent.call(t);if(u){u.on("mouseover",function(v){if(!u.hasClass(l)){u.addClass(i)}}).on("mouseout",function(v){u.removeClass(i)})}},_getItemTemplate:function(){var t=this,x=t.disabled?l:"",w=t.disabled?'disabled="disabled"':"",u=t.text?d:"",v=['<div id="',t.id,'" class="',f," ",x," ",t.containerCss,'"><button class="',g," ",t.css,'" autocomplete="off" hidefocus="true" ',w,' type="button">',t.text,"</button></div>"].join("");return v},_uiSetDisabled:function(w){var t=this,v=t.get("el"),u=v.one("button");if(w){v.addClass(l);u.attr(r,"");v.removeClass(i)}else{v.removeClass(l);u.removeAttr(r)}}});function h(u){var t=this;h.superclass.constructor.call(t,u)}j.extend(h,s);j.augment(h,{_getItemTemplate:function(){var t=this;return['<div id="',t.id,'"  class="',n,t.css,'">',t.text,"</div>"].join("")}});function k(u){var t=this;k.superclass.constructor.call(t,u)}j.extend(k,s);j.augment(k,{_getItemTemplate:function(){var t=this;return'<div class="'+c+'"></div>'}});function a(u){var t=this;a.superclass.constructor.call(t,u)}j.extend(a,s);j.augment(a,{_getItemTemplate:function(){var t=this;return['<div id="',t.id,'"  class="',n,'"><a class="',t.css,'" href = "',t.href,'">',t.text,"</a></div>"].join("")}});function m(u){var t=this;m.superclass.constructor.call(t,u)}j.extend(m,s);j.augment(m,{_getItemTemplate:function(){var t=this;return j.substitute(t.template,t)}});s.types={button:q,text:h,link:a,custom:m,seperator:k};return s},{requires:[]});KISSY.add("gallery/grid/1.0/buttonBar",function(b,d){var c="button-bar";function a(f){var e=this;f=e._formatConfig(f||{});a.superclass.constructor.call(e,f)}b.extend(a,d);b.augment(a,{CLS_BAR:c,_formatConfig:function(g){var e={renderTo:g.renderTo,items:[]},f=g.buttons||g.items;b.each(f,function(h){var i=b.merge({type:"button"},h);e.items.push(i)});return e}});return a},{requires:["./bar"]});KISSY.add("gallery/grid/1.0/calendar",function(b){function c(e){var d=b.DOM;Event=b.Event,date={};b.each(e,function(n){var i=d.get(n.selector);if(!i){return}var g=b.one(n.selector);if(g.hasAttr("readonly")){g.removeAttr("readonly")}if(!g.hasClass("ks-select-calendar")){g.addClass("ks-select-calendar")}if(n.showTime){if(!g.hasClass("calendar-time")){g.addClass("calendar-time")}}var o,f=n.showTime?"timeSelect":"select",m=n.showTime?"yyyy-mm-dd HH:MM:ss":"yyyy-mm-dd",k=n.min?a(n.min,new Date()):(n.min==0?new Date():null),l=n.max?a(n.max,new Date()):(n.max==0?new Date():null);if(n.config){o=new b.Calendar(n.selector,n.config)}else{var j=Date.parse(d.val(n.selector).replace(/\-/g,"/"));o=new b.Calendar(n.selector,{minDate:k,maxDate:l,selected:j?new Date(j):null,showTime:n.showTime,popup:true,triggerType:["click"]})}o.on(f,function(q){var r=d.get(n.selector);d.val(r,h(q.date));this.hide();r.focus()});Event.on(n.selector,"valuechange",function(p){if(!(p.keyCode==8||p.keyCode==46)){d.val(this,"")}});function h(p){return b.Date.format(p,m)}date[n.selector]=o});return date}var a=function(g,f){var e=new Date(f-0+g*86400000);e=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate();return new Date(e)};return c},{requires:["core","calendar"]});KISSY.add("gallery/grid/1.0/loadMask",function(b,a){var c=function(f,e){var d=this;d.el=f;c.superclass.constructor.call(d,e);d._init()};b.extend(c,b.Base);b.augment(c,{msg:"Loading...",msgCls:"x-mask-loading",disabled:false,_init:function(){var d=this;d.msg=d.get("msg")||d.msg},disable:function(){this.disabled=true},enable:function(){this.disabled=false},onLoad:function(){a.unmaskElement(this.el)},onBeforeLoad:function(){if(!this.disabled){a.maskElement(this.el,this.msg,this.msgCls)}},show:function(){this.onBeforeLoad()},hide:function(){this.onLoad()},destroy:function(){this.el=null}});b.LP.LoadMask=c;return c},{requires:["./util"]});KISSY.add("gallery/grid/1.0/paggingBar",function(e,k){var i="bar-btn-custom",h="pb-input-container",j="pb-text-container",d="pb-total-count",c="pb-total-page",g="pb-page-first",b="pb-page-last",l="pb-page-next",f="pb-page-prev",a="pb-page-ok",n="pagging-bar";function m(p){var o=this;p=o._formatConfig(p||{});e.mix(o,{start:0,end:0,totalCount:0,curPage:1,totalPage:1});m.superclass.constructor.call(o,p)}e.extend(m,k);e.augment(m,{CLS_BAR:n,_afterStoreLoad:function(v,p){var u=this,t=u.get("pageSize"),o=0,q=0,w=0,s=1,r=1;if(p){o=p.start||0}else{o=0}w=v.getTotalCount();q=w-o>t?o+v.getCount():w;r=parseInt((w+t-1)/t,10);r=r>0?r:1;s=parseInt(o/t,10)+1;u.start=o;u.end=q;u.totalCount=w;u.curPage=s;u.totalPage=r;u._setAllButtonsState();u._setNumberPages()},_getBarTemplate:function(){return'<div class="fr"></div>'},_getButtonConfig:function(s,p,q,r){var o=this;return{id:s,type:"button",css:p,text:r,containerCss:r?i:"",disabled:!!q,handler:function(v){var u=o._findItem(v.target),t=e.one("button",u);if(!DOM.hasClass(u,CLS_DISABLE)){o._pageAction(t)}}}},_getPageInfoConfig:function(){var o=['<span class="',j,'">第</span><span class="',h,'"><input type="text" autocomplete="off" class="',CLS_ITEM_INPUT,'" size="20" name="inputItem"></span><span class="',j," ",c,'">页 共 0 页</span>'].join("");return{type:"custom",template:o}},_getCountInfoConfig:function(){var o=['<div class="',j,'">共 <span class="',d,'">0</span> 条记录</div>'].join("");return{type:"custom",template:o}},_formatConfig:function(r){var p=this,q=[],o=e.merge(r,{items:q});q.push(p._getButtonConfig("btnfirst",g,true));q.push(p._getButtonConfig("btnpre",f,true));q.push({type:"seperator"});q.push(p._getPageInfoConfig());q.push({type:"seperator"});q.push(p._getButtonConfig("btnnext",l,true));q.push(p._getButtonConfig("btnlast",b,true));q.push(p._getButtonConfig("btnok",a,false,"跳转"));q.push({type:"seperator"});q.push(p._getCountInfoConfig());return o},_initEvent:function(){this.constructor.superclass._initEvent.call(this);var o=this,p=o.get("store"),q=o.get("bar");if(p){p.on("load",function(r){o._afterStoreLoad(p,r)})}q.one("."+CLS_ITEM_INPUT).on("keyup",function(s){s.stopPropagation();if(s.keyCode===13){var r=e.one(this),t=parseInt(r.val(),10);if(o._isPageAllowRedirect(t)){o.skipToPage(t)}else{r.val(o.curPage)}}})},_isPageAllowRedirect:function(p){var o=this;return p&&p>0&&p<=o.totalPage&&p!==o.curPage},_pageAction:function(p){var o=this,r=1;if(p.hasClass(g)){r=1}else{if(p.hasClass(l)){r=o.curPage+1}else{if(p.hasClass(f)){r=o.curPage-1}else{if(p.hasClass(b)){r=o.totalPage}else{if(p.hasClass(a)){var q=o.get("bar");inputEl=q.one("."+CLS_ITEM_INPUT),value=parseInt(inputEl.val(),10);if(o._isPageAllowRedirect(value)){r=value}else{inputEl.val(o.curPage);return}}}}}}o.skipToPage(r)},skipToPage:function(s){var o=this,q=o.get("store"),p=o.get("pageSize"),r=s-1,u=r*p;var t=o.fire("beforepagechange",{from:o.curPage,to:s});if(q&&t!==false){q.load({start:u,limit:p,pageIndex:r})}},_setAllButtonsState:function(){var o=this,q=o.get("store"),p=o.get("items");function r(t,s){e.each(p,function(u){if(e.inArray(u.id,t)){u.set("disabled",!s)}})}if(q){r(["btnpre","btnnext","btnfirst","btnlast","btnok"],true)}if(o.curPage===1){r(["btnpre","btnfirst"],false)}if(o.curPage===o.totalPage){r(["btnnext","btnlast"],false)}},_setNumberPages:function(){var o=this,r=o.get("bar"),q=r.one("."+CLS_ITEM_INPUT),s=r.one("."+c),p=r.one("."+d);if(q&&s){q.val(o.curPage);s.text("页 共 "+o.totalPage+" 页")}if(p){p.text(o.totalCount)}}});e.namespace("LP");e.LP.PaggingBar=m;return m},{requires:["./bar"]});KISSY.add("gallery/grid/1.0/store",function(a){function b(d){var c=this;d=d||{};d=a.merge({root:"rows",totalProperty:"results",dataType:"json",autoLoad:false,sortInfo:{field:"",direction:"ASC"},proxy:{method:"post"},params:{},remoteSort:false,matchFunction:function(f,e){return f==e},compareFunction:function(f,e){if(f==undefined){f=""}if(e==undefined){e=""}if(a.isString(f)){return f.localeCompare(e)}if(f>e){return 1}else{if(f===e){return 0}else{return -1}}}},d);a.mix(c,d,{hasLoad:false,resultRows:[],rowCount:0,totalCount:0});c.events=["load","beforeload","beforeProcessLoad","addrecords","exception","removerecords","updaterecord","localsort"];c._init()}a.augment(b,a.EventTarget);a.augment(b,{add:function(g,e,d){var c=this,f=[];d=d||c._getDefaultMatch();if(!a.isArray(g)){g=[g]}a.each(g,function(h){if(!e||!c.contains(h,d)){c._addRecord(h);f.push(h)}});c.fire("addrecords",{data:f})},compare:function(h,g,f,e){var c=this,d=1;f=f||c.sortInfo.field;e=e||c.sortInfo.direction;if(!f||!e){return 1}d=e==="ASC"?1:-1;return this.compareFunction(h[f],g[f])*d},contains:function(c,d){return this.findIndexBy(c,d)!==-1},findIndexBy:function(f,e){var c=-1,d=this.resultRows;e=e||_self._getDefaultMatch();if(a.isUndefined(f)||a.isNull(f)){return -1}a.each(d,function(g,h){if(e(f,g)){c=h;return false}});return c},find:function(f,e){var c=null,d=this.resultRows;a.each(d,function(g,h){if(g[name]===e){c=g;return false}});return c},findAll:function(f,e){var c=[],d=this.resultRows;a.each(d,function(g,h){if(g[name]===e){c.push(g)}});return c},load:function(c){this._loadData(c)},getResult:function(){return this.resultRows},getCount:function(){return this.resultRows.length},getTotalCount:function(){return this.totalCount},remove:function(e,d){var c=this,f=[];d=d||c._getDefaultMatch();if(!a.isArray(e)){e=[e]}a.each(e,function(i){var h=c.findIndexBy(i,d),g=c._removeAt(h);f.push(g)});c.fire("removerecords",{data:f})},setResult:function(d){d=d||[];var c=this;c.resultRows=d;c.rowCount=d.length;c.totalCount=d.length;c.fire("load",c.oldParams)},setValue:function(j,i,h,g){var d=j,c=this;if(g){var f=c._getDefaultMatch(),e=c.findIndexBy(j,f);if(e>=0){d=this.resultRows[e]}}d[i]=h;c.fire("updaterecord",{record:d,field:i,value:h})},sort:function(e,d){var c=this;c.sortInfo.field=e||c.sortInfo.field;c.sortInfo.direction=d||c.sortInfo.direction;if(c.remoteSort){this.load()}else{c._sortData(e,d);c.fire("localsort",{field:e,direction:d})}},update:function(h,g){var d=h,c=this;if(g){var f=c._getDefaultMatch(),e=c.findIndexBy(h,f);if(e>=0){d=this.resultRows[e]}}d=a.mix(d,h);c.fire("updaterecord",{record:d})},_addRecord:function(c,e){var d=this.resultRows;if(a.isUndefined(e)){e=d.length}d[e]=c},_loadData:function(g){var c=this,e=g||{};c.fire("beforeload");e=a.merge(c.oldParams,c.sortInfo,e);c.oldParams=e;var f=c.proxy.method==="post"?e:(e?a.param(e):"");a.ajax({cache:false,url:c.proxy.url,dataType:c.dataType,type:c.proxy.method,data:f,success:function(l,m,k){c.fire("beforeProcessLoad",{data:l});var j=[],i=0,h=0;if(l.hasError){d(j,i,h);c.fire("exception",{error:l.error});return}if(c.dataType==="json"){if(a.isArray(l)){j=l;i=j.length;h=i}else{if(l!=null){j=l[c.root];if(!j){j=[]}i=j.length;h=parseInt(l[c.totalProperty])}}}d(j,i,h);if(!c.remoteSort){c._sortData()}c.fire("load",e)},error:function(h,j,i){d([],0,0);c.fire("exception",{error:j,responseText:i.responseText,XMLHttpRequest:h})}});function d(j,i,h){c.resultRows=j;c.rowCount=i;c.totalCount=h}},_removeAt:function(f){if(f<0){return}var c=this,e=this.resultRows,d=e[f];e.splice(f,1);return d},_sortData:function(e,d){var c=this;e=e||c.sortInfo.field;d=d||c.sortInfo.direction;if(!e||!d){return}c.resultRows.sort(function(g,f){return c.compare(g,f,e,d)})},_getDefaultMatch:function(){return this.matchFunction},_init:function(){var c=this;c.oldParams=c.params||{};if(!c.proxy.url){c.proxy.url=c.url}c.resultRows=[]}});a.namespace("LP");a.LP.Store=b;return b},{requires:[]});KISSY.add("gallery/grid/1.0/grid",function(i,G,z,y){var A=i.DOM,s=i.UA,D=i.Node;var d="data-column-name",t="grid-header-th",v="grid-header-th-empty",h="grid-header-th-inner",a="grid-header-inner-title",r="grid-body-cell-text",B="grid-checkbox",g="grid-row",C="grid-row-selected",l="grid-row-over",f="grid-body-cell",o="grid-body-cell-inner",F="hover",n="sortable",k="sorted-asc",u="sorted-desc",w="grid-row-odd",E="grid-row-even",q="row-element",m=80,p=25,x=25,e=30,c=80,b=15;function j(I){var H=this;I=I||{};if(!I.renderTo){throw"please assign the id of rendered Dom!"}I=i.merge(j.config,I);j.superclass.constructor.call(H,I);H.events=["beginappend","afterappend","beginshow","aftershow","rowremoved","rowcreated","beforepagechange","rowclick","cellclick","rowselected","rowunselected"];H._init()}j.config={};i.extend(j,i.Base);i.augment(j,{appendData:function(J){var H=this,I=[];H.fire("beginappend",{data:J});i.each(J,function(L,K){var M=H._createRow(L,K);I.push(M)});H.fire("afterappend",{rows:I,data:J})},addSummary:function(I){var H=this,J=H.get("tfoot");i.all(J.rows).remove();this._createSummaryRow(I)},clearData:function(){var I=this,H=I.get("tbody");I._setHeaderChecked(false);i.all(H.rows).remove()},clearSelection:function(){this._setAllRowsSelected(false)},filter:function(M,L){var I=this,H=I.get("tbody"),K=i.makeArray(H.rows),J=typeof L==="function"?L:function(N){return N===L};i.each(K,function(P){var N=i.one(P),O=A.data(P,q);if(L===null){N.show()}else{if(!O||!J(O[M])){N.hide()}else{N.show()}}})},getWidth:function(){var H=this;return H.get("width")||H.get("gridEl").width()},getSelection:function(){var H=this,I=H.get("tbody"),J=i.all("."+C,I),K=[];i.each(J,function(M){var L=A.data(M,q);if(L){K.push(L)}});return K},getSelected:function(){var H=this,I=H.get("tbody"),J=i.one("."+C,I);return J?A.data(J,q):null},setSelection:function(L,I){var H=this,J=H.get("tbody"),K=J.rows;i.each(K,function(N){var M=A.data(N,q);if(M&&i.inArray(M[L],I)){H._setRowSelected(N,true)}})},setHeight:function(J){var I=this,L=I.get("gridEl"),M=p,H=I.get("body"),K=i.one(H);L.height(J);if(I.get("tbar")){M+=(x+2);if(I.get("tbar").buttons){M+=4}}if(I.get("bbar")){M+=(x+2)}if(J-M>0){K.height(J-M);K.css("overflow-y","scroll")}},setWidth:function(J){var I=this,H=I.get("body"),K=I.get("gridEl");K.width(J);i.one(H).width(J-2);K.children(".grid-view").width(J-2)},sort:function(J,L){var H=this,K,I=H.get("store"),M=L===1?"ASC":"DESC";if(typeof J==="string"){K=J}else{K=J.dataIndex}if(I){I.sort(K,M)}else{H._localSort(K,L)}},showData:function(I){var H=this;H.fire("beginshow");H.clearData();i.each(I,function(K,J){H._createRow(K,J)});H._afterShow();H.fire("aftershow")},removeData:function(K){var H=this,I=H.get("tbody"),J=i.makeArray(I.rows);i.each(J,function(M){var L=A.data(M,q);if(L&&i.inArray(L,K)){H.fire("rowremoved",{data:L,row:M});A.remove(M)}})},_addBodyEvent:function(K){var I=this,L=I.get("head"),H=I.get("body"),J=i.one(H);i.one(K).on("click",function(M){I._rowClickEvent(M.target)}).on("mouseover",function(M){I._rowOverEvent(M.target)}).on("mouseout",function(M){I._rowOutEvent(M.target)});J.on("scroll",function(M){var N=J.scrollLeft();i.one(L).scrollLeft(N)})},_afterShow:function(){var K=this,N=K.get("tbody"),J=K.get("body"),M=i.one(J),I,H,L;if(s.ie===6||s.ie===7){I=K.get("height");if(!I){H=M.width();L=J.scrollWidth;if(L>H){tbodyHeight=i.one(N).height();M.height(tbodyHeight+17)}else{M.css("height","auto")}}}},_createRow:function(L,K){var I=this,H=I.get("tbody"),O=I._getRowTemplate(K,L),J=new D(O).appendTo(H),N=J.getDOMNode(),M=N.lastChild;A.data(N,q,L);A.addClass(M,"lp-last");I.fire("rowcreated",{data:L,row:N});return J},_createSummaryRow:function(J){var H=this,K=H.get("tfoot"),L=H._getSummaryTemplate(J),I=new D(L).appendTo(K);return I},_lookupByClass:function(I,H){if(A.hasClass(I,H)){return I}return A.parent(I,"."+H)},_findRowByRecord:function(J){var I=this,K=I.get("tbody"),L=K.rows,H=null;i.each(L,function(N){var M=A.data(N,q);if(M===J){H=N;return false}});return H},_findRow:function(H){return this._lookupByClass(H,g)},_findCell:function(H){return this._lookupByClass(H,f)},_forceFitColumns:function(L){var P=this,N=P.getWidth(),O=P.get("height"),S=0,J=0,R=P.get("checkable")?e+1:0,I=0,H=1,Q=0,M=0,K=0;L=L||P.get("columns");M=L.length;i.each(L,function(U){U.width=U.width||c;var T=U.originWidth||U.width;if(!U.hide){S+=T;J+=1}});I=J*2+2+R+(O?b+2:0);H=(N-I)/S;Q=0;if(H!==1){i.each(L,function(T){if(!T.hide){T.originWidth=T.originWidth||T.width;T.width=Math.floor(T.originWidth*H);Q+=T.width}});K=N-(Q+I);if(M){L[M-1].width+=K}}},_getCheckedCellTemplate:function(I,H){return['<td width="30px" align="center" class="',I," ",H,'"><div class="',H,'-inner"><span class="gwt-CheckBox"><input type="checkbox" class="',B,'" tabindex="0"></span></div></td>'].join("")},_getColumn:function(K){var I=this,J=I.get("columns"),H=null;i.each(J,function(L){if(L.dataIndex==K){H=L;return false}});return H},_getRowTemplate:function(M,K){var N=this,P=N.get("columns"),J=M%2===0?w:E,L=[],O=null,Q=null,H="",I=N.get("checkable");if(I){Q=N._getCheckedCellTemplate("grid-row-checked-column",f);L.push(Q)}i.each(P,function(S,U){var T=K[S.dataIndex],V=S.renderer?S.renderer(T,K):T,R=N._getCellTemplate(U,S,V,T,K);L.push(R)});O=['<tr rowIndex="',M,'" class="',g," ",J,'">',L.join(""),H,"</tr>"].join("");return O},_getSummaryTemplate:function(L){var H=this,K=H.get("columns"),O=[],J=-1,N=-1,I=H.get("checkable");if(I){N+=1}function M(P){if(P>0){return'<td class="'+f+'" colspan="'+P+'"></td>'}else{return""}}i.each(K,function(Q,S){if(!Q.hide){N+=1;if(Q.summary){O.push(M(N-J-1));var R=L[Q.dataIndex],T="总计："+(Q.renderer?Q.renderer(R,L):R),P=H._getCellTemplate(S,Q,T,L);O.push(P);J=N}}});if(J!==N){O.push(M(N-J))}rowTemplate=['<tr class="',g,'">',O.join(""),"</tr>"].join("");return rowTemplate},_getCellTemplate:function(H,J,Q,O,K){var N=J.dataIndex,I=J.width,M=J.showTip?'title = "'+(O||"")+'"':"",L=J.hide?"ks-hidden":"",P=['<td  class="grid-body-cell grid-body-td-',N," ",L,'" data-column-name="',N,'" colindex="',H,'" width="',I,'px">','<div class="',o,'" style="width : ',I,'px"><span class="',r,' " ',M,">",Q,"</span></div></td>"].join("");return P},_getColumnsWidth:function(){var I=this,K=I.get("columns"),J=I.get("checkable"),H=0;if(J){H+=31}i.each(K,function(L){if(!L.hide){H+=L.width+2}});return H},_init:function(){var P=this,K=P.get("gridId"),H=P.get("container"),O=P.get("renderTo"),J=null,L=null,M=null,Q=null,N=null,T=null,I=0,S=P.get("height"),R=0;if(!H){H=A.get("#"+O);P.set("container",H)}if(!K){K=O+"grid";P.set("gridId",K)}J=['<div id="',K,'" class="grid-panel"><div id="',K+"tbar",'" class="grid-tbar" style="display : none;"></div><div class="grid-view"><div class="grid-header"><table  cellspacing="0" cellpadding="0" class="grid-table"><thead></thead></table></div><div class="grid-body grid-body-scroll"><table  cellspacing="0" cellpadding="0" class="grid-table"><tbody><tfoot></tfoot></tbody></table></div></div><div id="',K+"bbar",'" class="grid-bbar" style="display : none;"></div></div>'].join("");L=new D(J);L.appendTo(H);P.set("gridEl",L);M=A.get(".grid-header",H);Q=A.get(".grid-table",M);N=A.get(".grid-body",H);T=A.get(".grid-table",N);P.set("head",M);P.set("body",N);P.set("tbody",T.tBodies[0]);P.set("tfoot",T.tFoot);P.set("thead",Q.tHead);if(!P._isAutoFitWidth()){I=P.get("width");P.setWidth(I)}else{I=P._getColumnsWidth();P.setWidth(I+2)}if(S){P.setHeight(S)}P._initListeners();P._initHeader();P._initPaggingBar();P._initData();P._initEvent()},_initEvent:function(){this._initHeaderEvent();this._initBodyEvent();this._initDataEvent();this._initPaggingBarEvent()},_initBodyEvent:function(){var I=this,H=I.get("tbody");I._addBodyEvent(H)},_initData:function(){var H=this,I=H.get("store"),J=H.get("loadMask"),K=H.get("gridEl");if(J){J=new y(K,{msg:"Loading..."});H.set("loadMask",J)}if(I&&I.autoLoad){I.load()}},_initDataEvent:function(){var H=this,I=H.get("store");if(I){I.on("beforeload",function(){var J=H.get("loadMask");if(J){J.show()}});I.on("load",function(){var J=I.getResult(),K=H.get("loadMask");H.showData(J);if(K){K.hide()}});I.on("localsort",function(J){var K=J.direction==="ASC"?1:-1;H._localSort(J.field,K)});I.on("addrecords",function(J){var K=J.data;H.appendData(K)});I.on("removerecords",function(J){var K=J.data;H.removeData(K)});I.on("exception",function(){var J=H.get("loadMask");if(J){J.hide()}})}},_initHeaderEvent:function(){var I=this,N=I.get("thead"),K=I.get("checkable"),M=i.all("."+h,N);function L(O){i.one(this).parent().addClass(F)}function J(S){var Q=i.one(this),R=Q.parent(),T=null,P=null,O=null;if(R.hasClass(n)){T=R.attr(d);P=Q.hasClass(k)?u:k;O=P===k?1:-1;M.removeClass(k).removeClass(u);Q.addClass(P);I.sort(T,O)}}function H(O){i.one(this).parent().removeClass(F)}M.on("mouseover",L).on("mouseout",H).on("click",J);if(K){i.one("."+B,N).on("click",function(){I._setAllRowsSelected(i.one(this).attr("checked"))})}},_initHeader:function(){var P=this,I=P.get("columns"),K=P.get("thead"),O=K.insertRow(0),H=P.get("checkable"),L=0,J=null,M=0,Q=null;function N(W){var Y=W.sortable?n:"",X=Y?'<span class="grid-header-sort-icon">&nbsp;</span>':"",U=W.hide?"ks-hidden":"",V=W.width,R=W.cls,T=['<th align="left" class="',t," ",U," grid-header-column-",W.dataIndex," ",Y,'" data-column-name="',W.dataIndex,'">','<div class ="',t,"-inner ",R,' "><span class="',a,'">',W.title,"</span>",X,"</div>","</th>"].join(""),S=new D(T);S.width(V);S.appendTo(O)}if(H){J=P._getCheckedCellTemplate("grid-header-checked-column",t);new D(J).appendTo(O)}if(P.get("forceFit")){P._forceFitColumns()}i.each(I,function(S){var R=S.width||m;S.width=R;N(S)});if(!P._isAutoFitWidth()){Q=new D('<th class="'+t+' grid-header-th-empty"><div class ="'+t+'-inner"></div></th>');Q.appendTo(O);P._autoSetInnerWidth()}},_initListeners:function(){var H=this,J=H.get("listeners");if(J){for(var I in J){if(J.hasOwnProperty(I)){H.on(I,J[I])}}}},_setEmptyHeadCellWidth:function(K){var H=this,J=H.get("thead"),I=i.one("."+v,J);if(K<=0){I.hide()}else{I.attr("width",K+"px");I.show()}},_autoSetInnerWidth:function(){var N=this,I=N.get("thead"),K=N.get("tbody"),O=N.get("height"),H=N._getColumnsWidth(),P=0,M=N.get("forceFit"),L=N.getWidth(),J=M?b:L<(H+2)?b:L-(H+2);if(J>0&&J<b){J=b}N._setEmptyHeadCellWidth(J);P=H+(J?J+2:0);i.one(I).parent().width(P);if(O){H-=(b+2)}i.one(K).parent().width(H)},_initPaggingBar:function(){var O=this,J=O.get("gridId"),P=O.get("tbar"),L=O.get("bbar"),Q=O.get("store"),N=0,I=null,S=null,R=null,K=null;function H(U,V){var T=i.merge(U,{renderTo:V});if(Q&&!T.store){T.store=Q}return new z(T)}function M(T,V){var U=i.merge(T,{renderTo:V});return new G(U)}if(P){if(P.pageSize){I=H(P,J+"tbar");O.set("tpaggingBar",I);N=P.pageSize}if(P.buttons){S=M(P,J+"tbar");O.set("tbuttonBar",S)}}if(L){R=H(L,J+"bbar");O.set("bpaggingBar",R);N=L.pageSize}if(N&&Q){K=Q.params;if(!K.start){K.start=0;K.pageIndex=0}if(!K.limit||K.limit!==N){K.limit=N}}},_initPaggingBarEvent:function(){var H=this,J=H.get("tpaggingBar"),I=H.get("bpaggingBar");if(J){J.on("beforepagechange",function(K){H.fire("beforepagechange",K)})}if(I){I.on("beforepagechange",function(K){H.fire("beforepagechange",K)})}},_isAutoFitWidth:function(){return !this.get("width")},_isRowSelected:function(H){return i.one(H).hasClass(C)},_localSort:function(N,M){var H=this,J=H.get("tbody"),I=H.get("store"),L=i.makeArray(J.rows);function K(Q,P){var O=A.data(Q,q);return O?O[P]:""}if(I){L.sort(function(P,O){var R=A.data(P,q),Q=A.data(O,q);return I.compare(R,Q)})}else{L.sort(function(Q,P){var R=K(Q,N),O=K(P,N);if(R<O){return -M}if(R>O){return M}return 0})}i.each(L,function(P){var O=i.one(P);O.appendTo(J)})},_rowClickEvent:function(L){var I=this,M=I._findRow(L),H=I._findCell(L),J=I.get("checkable"),K=null;if(M){K=A.data(M,q);I.fire("rowclick",{data:K,row:M});if(H){I.fire("cellclick",{data:K,row:M,cell:H,field:A.attr(H,d),domTarget:L})}if(J){if(!I._isRowSelected(M)){I._setRowSelected(M,true)}else{I._setRowSelected(M,false)}}else{i.all("."+C,M.parentNode).removeClass(C);A.addClass(M,C)}}},_rowOverEvent:function(I){var H=this,J=H._findRow(I);if(J){i.one(J).addClass(l)}},_rowOutEvent:function(I){var H=this,J=H._findRow(I);if(J){i.one(J).removeClass(l)}},_setColumnWidth:function(L,K){if(typeof(L)==="string"){L=this._getColumn(L)}var H=this,N=L.dataIndex,J=".grid-header-column-"+N,O=".grid-body-td"+N,M=H.get("thead"),I=H.get("tbody");if(L.width!=K){L.width=K;i.one(J,M).width(K);i.all(O,I).width(K).children(".grid-body-cell-inner").width(K)}},_setHeaderChecked:function(J){var I=this,K=I.get("thead"),H=i.one("."+B,K);if(H){H.attr("checked",J)}},_setRowSelected:function(N,K){var I=this,J=i.one(N),M=A.get("."+B,N),L=A.data(N,q),H=A.hasClass(N,C);if(H===K){return}if(M){M.checked=K}if(K){A.addClass(N,C);I.fire("rowselected",{data:L})}else{A.removeClass(N,C);I._setHeaderChecked(false);I.fire("rowunselected",{data:L,row:N})}I.fire("rowselectchanged",{data:L,row:N})},_setAllRowsSelected:function(J){var I=this,H=I.get("tbody");i.each(H.rows,function(K){I._setRowSelected(K,J)})},destory:function(){}});i.namespace("LP");i.LP.Grid=j;return j},{requires:["./buttonBar","./paggingBar","./loadMask"]});